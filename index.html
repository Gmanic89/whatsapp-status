<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ‚úÖ META TAGS OPTIMIZADOS PARA GAMING -->
    <title>Fwild Community | Comunidad Oficial de Gaming</title>
    <meta
      name="description"
      content="Comunidad oficial de jugadores Fwild. √önete a nuestro clan, participa en torneos online y conecta con miles de gamers. Productos digitales y servicios exclusivos. +21 a√±os."
    />
    <meta
      name="keywords"
      content="fwild, gaming, clan, comunidad gamers, torneos online, esports, videojuegos, equipo gaming, guild, productos gaming"
    />
    <meta name="author" content="FortunatoWild SAS" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph para WhatsApp/Redes -->
    <meta property="og:title" content="Fwild Community - Comunidad Oficial" />
    <meta
      property="og:description"
      content="Comunidad de jugadores online. √önete a nuestro clan y accede a productos digitales exclusivos. +21 a√±os."
    />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Fwild" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Fwild Community" />
    <meta
      name="twitter:description"
      content="Comunidad oficial de jugadores. Torneos, eventos y productos exclusivos."
    />

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-RJWDV50N7N"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'G-RJWDV50N7N');
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #0a1628 0%, #1a2332 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 20px;
      }

      .main-content {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .container {
        text-align: center;
        max-width: 400px;
        width: 100%;
      }

      .logo-container {
        margin: 0 auto 40px;
        text-align: center;
      }

      .logo-image {
        width: 350px;
        max-width: 90%;
        height: auto;
        filter: drop-shadow(0 10px 30px rgba(255, 193, 7, 0.3));
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-12px);
        }
      }

      .subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 16px;
        margin-bottom: 25px;
        font-weight: 500;
      }

      /* ‚úÖ DISCLAIMER LEGAL COMPACTO */
      .legal-notice {
        background: rgba(255, 193, 7, 0.12);
        padding: 8px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 3px solid #ffc107;
        text-align: center;
      }

      .legal-notice p {
        margin: 0;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.4;
      }

      .legal-notice strong {
        color: #ffc107;
        font-weight: 600;
      }

      .button-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .contact-button {
        padding: 20px 40px;
        font-size: 20px;
        font-weight: 600;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .whatsapp-button {
        background: #25d366;
        color: white;
      }

      .whatsapp-button:hover {
        background: #20bd5a;
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
      }

      .telegram-button {
        background: #0088cc;
        color: white;
      }

      .telegram-button:hover {
        background: #0077b3;
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 136, 204, 0.4);
      }

      .button-icon {
        font-size: 28px;
      }

      .info-text {
        color: white;
        margin-top: 30px;
        font-size: 14px;
        opacity: 0.8;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }

      .loading-overlay.show {
        display: flex;
      }

      .loading-content {
        text-align: center;
        color: white;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        margin: 0 auto 20px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ========== FOOTER PROFESIONAL DISCRETO ========== */
      .legal-footer {
        background: rgba(26, 35, 50, 0.95);
        border-top: 1px solid rgba(255, 193, 7, 0.2);
        padding: 25px 20px 20px;
        margin-top: 60px;
        backdrop-filter: blur(10px);
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 30px;
        margin-bottom: 25px;
      }

      .footer-section h4 {
        color: #ffc107;
        font-size: 14px;
        margin-bottom: 12px;
        font-weight: 600;
      }

      .footer-section p,
      .footer-section a {
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        line-height: 1.8;
        text-decoration: none;
        transition: color 0.3s;
      }

      .footer-section a:hover {
        color: #ffc107;
      }

      .footer-links {
        list-style: none;
        padding: 0;
      }

      .footer-links li {
        margin-bottom: 8px;
      }

      .footer-disclaimer {
        background: rgba(255, 193, 7, 0.08);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 3px solid #ffc107;
      }

      .footer-disclaimer p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 11px;
        line-height: 1.6;
        margin: 0;
      }

      .footer-bottom {
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .footer-bottom p {
        color: rgba(255, 255, 255, 0.5);
        font-size: 11px;
        margin: 5px 0;
      }

      /* ========== ESTILOS DEL CHAT WIDGET ========== */
      #chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        cursor: pointer;
        font-size: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9998;
        transition: all 0.3s ease;
        animation: pulse-chat 2s infinite;
      }

      @keyframes pulse-chat {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
      }

      #chat-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.8);
        animation: none;
      }

      #chat-button.hidden {
        display: none;
      }

      #chat-container {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 380px;
        height: 550px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        display: none;
        flex-direction: column;
        z-index: 9999;
        overflow: hidden;
        animation: slideUp 0.3s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      #chat-container.active {
        display: flex;
      }

      #chat-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 18px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      #chat-header h3 {
        font-size: 17px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      #chat-close {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }

      #chat-close:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: rotate(90deg);
      }

      #register-form {
        padding: 30px 25px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        justify-content: center;
        flex: 1;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }

      #register-form h4 {
        text-align: center;
        color: #333;
        margin-bottom: 5px;
        font-size: 22px;
      }

      #register-form p {
        text-align: center;
        color: #666;
        margin-bottom: 15px;
        font-size: 14px;
      }

      #register-form input {
        padding: 14px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s;
        background: white;
      }

      #register-form input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      #register-form button {
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      #register-form button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      #register-form button:active {
        transform: translateY(0);
      }

      #messages-area {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f5f5f5;
        display: none;
      }

      #messages-area.active {
        display: block;
      }

      #messages-area::-webkit-scrollbar {
        width: 6px;
      }

      #messages-area::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      #messages-area::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
      }

      #messages-area::-webkit-scrollbar-thumb:hover {
        background: #999;
      }

      .message {
        margin-bottom: 16px;
        display: flex;
        flex-direction: column;
        animation: fadeIn 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        align-items: flex-end;
      }

      .message.bot {
        align-items: flex-start;
      }

      .message-bubble {
        max-width: 75%;
        padding: 12px 16px;
        border-radius: 18px;
        word-wrap: break-word;
        line-height: 1.4;
      }

      .message.user .message-bubble {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .message.bot .message-bubble {
        background: white;
        color: #333;
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .message-time {
        font-size: 11px;
        color: #999;
        margin-top: 4px;
        padding: 0 4px;
      }

      .message-image {
        max-width: 75%;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .message-image:hover {
        transform: scale(1.02);
      }

      .quick-options {
        padding: 8px 12px;
        background: #fafafa;
        border-top: 1px solid #e0e0e0;
        display: none;
        gap: 6px;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .quick-options.active {
        display: flex;
      }

      .quick-option-btn {
        flex: 1;
        min-width: calc(33.333% - 4px);
        padding: 8px 10px;
        background: white;
        border: 1.5px solid #667eea;
        border-radius: 16px;
        color: #667eea;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        white-space: nowrap;
      }

      .quick-option-btn:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .quick-option-btn:active {
        transform: translateY(0);
      }

      #input-area {
        padding: 15px;
        background: white;
        border-top: 1px solid #e0e0e0;
        display: none;
      }

      #input-area.active {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }

      #message-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 24px;
        font-size: 14px;
        resize: none;
        font-family: inherit;
        max-height: 100px;
        transition: border 0.3s;
      }

      #message-input:focus {
        outline: none;
        border-color: #667eea;
      }

      #send-button {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        transition: all 0.2s;
        flex-shrink: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      #send-button:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      #send-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .connection-status {
        font-size: 12px;
        padding: 8px 15px;
        text-align: center;
        display: none;
      }

      .connection-status.show {
        display: block;
        animation: slideDown 0.3s ease-out;
      }

      .connection-status.success {
        background: #d4edda;
        color: #155724;
        border-bottom: 1px solid #c3e6cb;
      }

      .connection-status.error {
        background: #f8d7da;
        color: #721c24;
        border-bottom: 1px solid #f5c6cb;
      }

      .connection-status.warning {
        background: #fff3cd;
        color: #856404;
        border-bottom: 1px solid #ffeaa7;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .system-message {
        text-align: center;
        padding: 10px;
        color: #666;
        font-size: 13px;
        margin: 10px 0;
        background: rgba(0, 0, 0, 0.03);
        border-radius: 8px;
      }

      .typing-indicator {
        display: none;
        padding: 10px 20px;
        align-items: center;
      }

      .typing-indicator.show {
        display: flex;
      }

      .typing-dots {
        display: inline-flex;
        gap: 4px;
        padding: 12px 16px;
        background: white;
        border-radius: 18px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .typing-dots span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #999;
        animation: typing 1.4s infinite;
      }

      .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-10px);
        }
      }

      @media (max-width: 768px) {
        .logo-image {
          width: 280px;
        }

        .subtitle {
          font-size: 14px;
        }

        .contact-button {
          padding: 18px 30px;
          font-size: 18px;
        }

        .footer-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        #chat-container {
          width: calc(100vw - 20px);
          height: calc(100vh - 100px);
          bottom: 10px;
          right: 10px;
          left: 10px;
          border-radius: 12px;
        }

        #chat-button {
          bottom: 15px;
          right: 15px;
          width: 56px;
          height: 56px;
        }

        .quick-option-btn {
          font-size: 11px;
          padding: 7px 8px;
        }
      }

      @media (max-width: 480px) {
        .logo-image {
          width: 240px;
        }

        .subtitle {
          font-size: 13px;
          margin-bottom: 20px;
        }

        .legal-notice {
          padding: 6px 12px;
          margin-bottom: 15px;
        }

        .legal-notice p {
          font-size: 11px;
        }

        .contact-button {
          padding: 16px 25px;
          font-size: 16px;
        }

        .button-icon {
          font-size: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      <div class="container">
        <div class="logo-container">
          <img
            src="fwild-logo.png"
            alt="FWILD Gaming Platform"
            class="logo-image"
          />
        </div>

        <p class="subtitle">Comunidad Oficial de Jugadores</p>

        <!-- ‚úÖ DISCLAIMER LEGAL COMPACTO -->
        <div class="legal-notice">
          <p>
            üîû <strong>Solo +21 a√±os</strong>
          </p>
        </div>

        <div class="button-container">
          <button class="contact-button whatsapp-button" id="whatsappBtn">
            <span class="button-icon">üí¨</span>
            <span>Consultar Productos</span>
          </button>

          <button class="contact-button telegram-button" id="telegramBtn">
            <span class="button-icon">‚úàÔ∏è</span>
            <span>Unirse al Clan</span>
          </button>
        </div>

        <p class="info-text">Soporte 24/7 para miembros</p>
      </div>
    </div>

    <!-- ========== FOOTER LEGAL PROFESIONAL DISCRETO ========== -->
    <footer class="legal-footer">
      <div class="footer-content">
        <div class="footer-grid">
          
          <!-- Columna 1: Empresa -->
          <div class="footer-section">
            <h4>FortunatoWild SAS</h4>
            <p>Comunidad oficial de gaming</p>
            <p>üìç San Fernando, Buenos Aires, AR</p>
            <p>üìß fortunatowildson@gmail.com</p>
          </div>

          <!-- Columna 2: Legal -->
          <div class="footer-section">
            <h4>Informaci√≥n Legal</h4>
            <ul class="footer-links">
              <li><a href="#terminos" onclick="alert('Archivo: terminos.html')">üìÑ T√©rminos y Condiciones</a></li>
              <li><a href="#privacidad" onclick="alert('Archivo: privacidad.html')">üîí Pol√≠tica de Privacidad</a></li>
              <li><a href="#aviso" onclick="alert('Archivo: aviso-legal.html')">‚öñÔ∏è Aviso Legal</a></li>
            </ul>
          </div>

          <!-- Columna 3: Soporte -->
          <div class="footer-section">
            <h4>Soporte</h4>
            <ul class="footer-links">
              <li><a href="#chat">üí¨ Chat en Vivo</a></li>
              <li><a href="mailto:fortunatowildson@gmail.com">üìß Email</a></li>
              <li>‚è∞ Atenci√≥n 24/7</li>
            </ul>
          </div>

          <!-- Columna 4: Restricci√≥n -->
          <div class="footer-section">
            <h4>Restricciones</h4>
            <p style="background: rgba(255,193,7,0.1); padding: 10px; border-radius: 6px; border-left: 3px solid #ffc107;">
              <strong style="color: #ffc107;">üîû Solo +21 a√±os</strong><br>
              Servicio exclusivo para mayores de edad.
            </p>
          </div>

        </div>

        <!-- Disclaimer Defensa del Consumidor -->
        <div class="footer-disclaimer">
          <p>
            <strong>üõ°Ô∏è Defensa del Consumidor - Argentina:</strong> 
            FortunatoWild SAS cumple con la Ley 24.240. 
            Consultas/Reclamos: <strong>0800-666-1518</strong> | 
            <a href="https://www.argentina.gob.ar/produccion/defensadelconsumidor" target="_blank" style="color: #ffc107;">Direcci√≥n Nacional de Defensa del Consumidor</a>
          </p>
        </div>

        <!-- Copyright -->
        <div class="footer-bottom">
          <p>¬© 2024 <strong>FortunatoWild SAS</strong>. Todos los derechos reservados.</p>
          <p>San Fernando, Buenos Aires, Argentina</p>
          <p>Protegido por Ley 25.326 de Protecci√≥n de Datos Personales</p>
        </div>

      </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Conectando...</p>
      </div>
    </div>

    <!-- Chat Button -->
    <button id="chat-button">üí¨</button>

    <!-- Chat Container -->
    <div id="chat-container">
      <div id="chat-header">
        <h3>üí¨ Soporte Fwild</h3>
        <button id="chat-close">√ó</button>
      </div>

      <div class="connection-status" id="connection-status"></div>

      <div id="register-form">
        <h4>¬°Hola! üëã</h4>
        <p>Ingres√° tu nombre para iniciar el chat</p>
        <input
          type="text"
          id="username-input"
          placeholder="Tu nombre de jugador"
          maxlength="30"
          autocomplete="off"
        />
        <button id="register-button">Iniciar Chat</button>
      </div>

      <div id="messages-area"></div>

      <div class="typing-indicator" id="typing-indicator">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <!-- ‚úÖ OPCIONES R√ÅPIDAS MEJORADAS (SIN CBU/RETIRO) -->
      <div class="quick-options" id="quick-options">
        <button
          class="quick-option-btn"
          onclick="selectQuickOption('Info de Productos')"
        >
          üì¶ PRODUCTOS
        </button>
        <button
          class="quick-option-btn"
          onclick="selectQuickOption('Estado de Compra')"
        >
          üìã MI PEDIDO
        </button>
        <button
          class="quick-option-btn"
          onclick="selectQuickOption('Soporte T√©cnico')"
        >
          üõ†Ô∏è SOPORTE
        </button>
      </div>

      <div id="input-area">
        <textarea
          id="message-input"
          placeholder="Escribe un mensaje..."
          rows="1"
        ></textarea>
        <button id="send-button">‚û§</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js"></script>

    <script>
      const BACKEND_URL = 'https://fortunabot-production.up.railway.app';

      function d(s) {
        return atob(s);
      }

      const enc = {
        main: d('NTQy') + d('MjE0NDA3MzYz'),
        telegram: d('Zm9ydHVuYXdpbGQwMQ==')
      };

      function getRandomWhatsAppURL(phone, message) {
        const encodedMessage = encodeURIComponent(message);
        const formats = [
          'https://wa.me/' + phone + '?text=' + encodedMessage,
          'https://api.whatsapp.com/send?phone=' + phone + '&text=' + encodedMessage,
          'https://api.whatsapp.com/send/?phone=' + phone + '&text=' + encodedMessage + '&app_absent=0'
        ];
        return formats[Math.floor(Math.random() * formats.length)];
      }

      function canUserClick() {
        const now = Date.now();
        const lastClick = localStorage.getItem('last_fwild_click');
        const firstClickTime = localStorage.getItem('fwild_first_click_time');
        const totalClicks = parseInt(localStorage.getItem('fwild_total_clicks') || '0');

        if (firstClickTime) {
          const timeElapsed = now - parseInt(firstClickTime);
          const thirtyMinutes = 30 * 60 * 1000;

          if (timeElapsed >= thirtyMinutes) {
            localStorage.removeItem('fwild_total_clicks');
            localStorage.removeItem('fwild_first_click_time');
            localStorage.removeItem('last_fwild_click');
            location.reload();
            return { allowed: false, reason: 'reload' };
          }
        }

        if (lastClick && now - parseInt(lastClick) < 3000) {
          return {
            allowed: false,
            reason: 'fast',
            message: 'Por favor espera unos segundos antes de intentar nuevamente'
          };
        }

        if (totalClicks >= 3) {
          const timeElapsed = now - parseInt(firstClickTime);
          const thirtyMinutes = 30 * 60 * 1000;
          const timeRemaining = thirtyMinutes - timeElapsed;
          const minutesRemaining = Math.ceil(timeRemaining / 60000);

          return {
            allowed: false,
            reason: 'limit',
            message: 'Has alcanzado el l√≠mite de 3 intentos. Podr√°s intentar nuevamente en ' + minutesRemaining + ' minutos.'
          };
        }

        if (totalClicks === 0) {
          localStorage.setItem('fwild_first_click_time', now.toString());
        }

        const newTotal = totalClicks + 1;
        localStorage.setItem('fwild_total_clicks', newTotal.toString());
        localStorage.setItem('last_fwild_click', now.toString());

        return { allowed: true, remaining: 3 - newTotal };
      }

      document.getElementById('whatsappBtn').onclick = function () {
        const clickCheck = canUserClick();

        if (!clickCheck.allowed) {
          alert(clickCheck.message);
          if (clickCheck.reason === 'limit') {
            document.getElementById('whatsappBtn').style.opacity = '0.5';
            document.getElementById('whatsappBtn').style.cursor = 'not-allowed';
            document.getElementById('telegramBtn').style.opacity = '0.5';
            document.getElementById('telegramBtn').style.cursor = 'not-allowed';
          }
          return;
        }

        if (clickCheck.remaining !== undefined && clickCheck.remaining > 0) {
          console.log('Te quedan ' + clickCheck.remaining + ' intentos');
        }

        document.getElementById('loadingOverlay').classList.add('show');

        if (typeof gtag !== 'undefined') {
          gtag('event', 'whatsapp_support_click', {
            event_category: 'engagement',
            event_label: 'Fwild Support'
          });
        }

        const initialMessage = 'Hola! Quiero consultar sobre productos de Fwild üéÆ';
        const waUrl = getRandomWhatsAppURL(enc.main, initialMessage);

        setTimeout(function () {
          window.location.href = waUrl;
          setTimeout(function () {
            document.getElementById('loadingOverlay').classList.remove('show');
          }, 2000);
        }, 800);
      };

      document.getElementById('telegramBtn').onclick = function () {
        const clickCheck = canUserClick();

        if (!clickCheck.allowed) {
          alert(clickCheck.message);
          if (clickCheck.reason === 'limit') {
            document.getElementById('whatsappBtn').style.opacity = '0.5';
            document.getElementById('whatsappBtn').style.cursor = 'not-allowed';
            document.getElementById('telegramBtn').style.opacity = '0.5';
            document.getElementById('telegramBtn').style.cursor = 'not-allowed';
          }
          return;
        }

        if (clickCheck.remaining !== undefined && clickCheck.remaining > 0) {
          console.log('Te quedan ' + clickCheck.remaining + ' intentos');
        }

        document.getElementById('loadingOverlay').classList.add('show');

        if (typeof gtag !== 'undefined') {
          gtag('event', 'telegram_clan_click', {
            event_category: 'engagement',
            event_label: 'Fwild Telegram'
          });
        }

        setTimeout(function () {
          window.location.href = 'https://t.me/' + enc.telegram;
          setTimeout(function () {
            document.getElementById('loadingOverlay').classList.remove('show');
          }, 2000);
        }, 800);
      };

      if (typeof gtag !== 'undefined') {
        gtag('event', 'page_view', {
          event_category: 'engagement',
          event_label: 'fwild_community',
          page_title: 'Fwild Community'
        });
      }

      window.onload = function () {
        const now = Date.now();
        const totalClicks = parseInt(localStorage.getItem('fwild_total_clicks') || '0');
        const firstClickTime = localStorage.getItem('fwild_first_click_time');

        if (firstClickTime) {
          const timeElapsed = now - parseInt(firstClickTime);
          const thirtyMinutes = 30 * 60 * 1000;

          if (timeElapsed >= thirtyMinutes && totalClicks > 0) {
            localStorage.removeItem('fwild_total_clicks');
            localStorage.removeItem('fwild_first_click_time');
            localStorage.removeItem('last_fwild_click');
            console.log('L√≠mite reseteado autom√°ticamente');
          }
        }

        const currentClicks = parseInt(localStorage.getItem('fwild_total_clicks') || '0');

        if (currentClicks >= 3) {
          const firstClick = localStorage.getItem('fwild_first_click_time');
          if (firstClick) {
            const timeElapsed = now - parseInt(firstClick);
            const thirtyMinutes = 30 * 60 * 1000;
            const timeRemaining = thirtyMinutes - timeElapsed;
            const minutesRemaining = Math.ceil(timeRemaining / 60000);

            document.getElementById('whatsappBtn').style.opacity = '0.5';
            document.getElementById('whatsappBtn').style.cursor = 'not-allowed';
            document.getElementById('telegramBtn').style.opacity = '0.5';
            document.getElementById('telegramBtn').style.cursor = 'not-allowed';

            document.querySelector('.info-text').textContent = '‚è±Ô∏è L√≠mite alcanzado. Espera ' + minutesRemaining + ' minutos';
            document.querySelector('.info-text').style.color = '#ffeb3b';
          }
        }
      };

      // ========== CHAT WIDGET ==========
      var socket = null;
      var username = null;
      var sessionId = null;
      var isReconnecting = false;

      var chatButton = document.getElementById('chat-button');
      var chatContainer = document.getElementById('chat-container');
      var chatClose = document.getElementById('chat-close');
      var registerForm = document.getElementById('register-form');
      var usernameInput = document.getElementById('username-input');
      var registerButton = document.getElementById('register-button');
      var messagesArea = document.getElementById('messages-area');
      var inputArea = document.getElementById('input-area');
      var messageInput = document.getElementById('message-input');
      var sendButton = document.getElementById('send-button');
      var connectionStatus = document.getElementById('connection-status');
      var typingIndicator = document.getElementById('typing-indicator');
      var quickOptions = document.getElementById('quick-options');

      function saveSession(user, session) {
        var sessionData = {
          username: user,
          sessionId: session,
          timestamp: Date.now()
        };
        localStorage.setItem('fwild_chat_session', JSON.stringify(sessionData));
        console.log('üíæ Sesi√≥n guardada:', sessionData);
      }

      function loadSession() {
        var savedSession = localStorage.getItem('fwild_chat_session');
        if (!savedSession) return null;
        var sessionData = JSON.parse(savedSession);
        console.log('üìÇ Sesi√≥n cargada:', sessionData);
        return sessionData;
      }

      chatButton.addEventListener('click', function () {
        var savedSession = loadSession();

        if (savedSession) {
          username = savedSession.username;
          sessionId = savedSession.sessionId;
          isReconnecting = true;

          chatContainer.classList.add('active');
          chatButton.classList.add('hidden');

          registerForm.style.display = 'none';
          messagesArea.classList.add('active');
          inputArea.classList.add('active');
          quickOptions.classList.add('active');

          addSystemMessage('Reconectando como ' + username + '...');

          if (!socket || !socket.connected) {
            connectToBot();
          }
        } else {
          chatContainer.classList.add('active');
          chatButton.classList.add('hidden');
        }
      });

      chatClose.addEventListener('click', function () {
        chatContainer.classList.remove('active');
        chatButton.classList.remove('hidden');
      });

      registerButton.addEventListener('click', startChat);
      usernameInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') startChat();
      });

      function startChat() {
        var name = usernameInput.value.trim();
        if (name.length < 2) {
          alert('Por favor, ingres√° un nombre v√°lido (m√≠nimo 2 caracteres)');
          return;
        }

        username = name;
        sessionId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        isReconnecting = false;

        saveSession(username, sessionId);

        registerForm.style.display = 'none';
        messagesArea.classList.add('active');
        inputArea.classList.add('active');
        quickOptions.classList.add('active');

        addSystemMessage('Conectando...');
        connectToBot();

        if (typeof gtag !== 'undefined') {
          gtag('event', 'chat_widget_start', {
            event_category: 'engagement',
            event_label: 'Fwild Chat'
          });
        }
      }

      function connectToBot() {
        console.log('üîå Conectando al bot:', BACKEND_URL);

        socket = io(BACKEND_URL + '/client', {
          transports: ['websocket', 'polling'],
          reconnection: true,
          reconnectionDelay: 1000,
          reconnectionAttempts: 5
        });

        socket.on('connect', function () {
          console.log('‚úÖ Conectado al bot, Socket ID:', socket.id);
          showStatus('Conectado ‚úì', 'success');

          socket.emit('web_chat_start', {
            username: username,
            sessionId: sessionId,
            isReconnecting: isReconnecting
          });
        });

        socket.on('chat_history', function (data) {
          console.log('üìú Historial recibido:', data.messages.length, 'mensajes');

          messagesArea.innerHTML = '';

          data.messages.forEach(function (msg) {
            addMessage(msg.type, msg.message, new Date(msg.timestamp));
          });

          scrollToBottom();
          showStatus('Historial cargado ‚úì', 'success');
        });

        socket.on('disconnect', function () {
          console.log('‚ùå Desconectado del bot');
          showStatus('Desconectado. Reconectando...', 'warning');
        });

        socket.on('connect_error', function (error) {
          console.error('‚ùå Error de conexi√≥n:', error);
          showStatus('Error de conexi√≥n. Verifica tu internet.', 'error');
        });

        socket.on('bot_message', function (data) {
          console.log('üí¨ Mensaje del bot recibido:', data);
          hideTyping();

          if (data.imageData) {
            addImageMessage('bot', data.imageData, data.message || '');
          } else {
            addMessage('bot', data.message, new Date());
          }

          if (data.showMenu) {
            console.log('üìã Mostrando botones r√°pidos');
            quickOptions.classList.add('active');
          }
        });

        socket.on('admin_message', function (data) {
          console.log('üí¨ Mensaje del admin recibido:', data);
          hideTyping();
          addMessage('bot', data.message, data.timestamp || new Date());
        });

        socket.on('admin_image', function (data) {
          console.log('üì∑ Imagen del admin recibida');
          hideTyping();
          addImageMessage('bot', data.imageData, data.caption || '');
        });

        socket.on('message_sent', function () {
          console.log('‚úÖ Mensaje enviado correctamente');
        });

        socket.on('error', function (data) {
          console.error('‚ùå Error:', data);
          showStatus(data.message || 'Ocurri√≥ un error', 'error');
        });
      }

      sendButton.addEventListener('click', sendMessage);
      messageInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      function sendMessage() {
        var message = messageInput.value.trim();
        if (!message || !socket) return;

        addMessage('user', message, new Date());

        socket.emit('message', {
          message: message
        });

        messageInput.value = '';
        autoResize(messageInput);
        showTyping();
      }

      window.selectQuickOption = function (option) {
        console.log('üéØ Opci√≥n r√°pida seleccionada:', option);

        addMessage('user', option, new Date());

        if (socket) {
          socket.emit('message', {
            message: option
          });
          showTyping();
        }

        if (typeof gtag !== 'undefined') {
          gtag('event', 'chat_quick_option', {
            event_category: 'engagement',
            event_label: option
          });
        }
      };

      function addMessage(type, text, timestamp) {
        var messageDiv = document.createElement('div');
        messageDiv.className = 'message ' + type;

        var bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.textContent = text;

        var time = document.createElement('div');
        time.className = 'message-time';
        time.textContent = formatTime(timestamp);

        messageDiv.appendChild(bubble);
        messageDiv.appendChild(time);
        messagesArea.appendChild(messageDiv);
        scrollToBottom();
      }

      function addImageMessage(type, imageSrc, caption) {
        var messageDiv = document.createElement('div');
        messageDiv.className = 'message ' + type;

        var img = document.createElement('img');
        img.className = 'message-image';
        img.src = imageSrc;
        img.onclick = function () {
          window.open(imageSrc, '_blank');
        };

        messageDiv.appendChild(img);

        if (caption) {
          var bubble = document.createElement('div');
          bubble.className = 'message-bubble';
          bubble.textContent = caption;
          messageDiv.appendChild(bubble);
        }

        var time = document.createElement('div');
        time.className = 'message-time';
        time.textContent = formatTime(new Date());
        messageDiv.appendChild(time);

        messagesArea.appendChild(messageDiv);
        scrollToBottom();
      }

      function addSystemMessage(text) {
        var messageDiv = document.createElement('div');
        messageDiv.className = 'system-message';
        messageDiv.textContent = text;
        messagesArea.appendChild(messageDiv);
        scrollToBottom();
      }

      function showStatus(message, type) {
        connectionStatus.textContent = message;
        connectionStatus.className = 'connection-status ' + type + ' show';

        setTimeout(function () {
          connectionStatus.classList.remove('show');
        }, 3000);
      }

      function showTyping() {
        typingIndicator.classList.add('show');
        scrollToBottom();
      }

      function hideTyping() {
        typingIndicator.classList.remove('show');
      }

      function formatTime(timestamp) {
        var date = new Date(timestamp);
        return date.toLocaleTimeString('es-AR', {
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      function scrollToBottom() {
        messagesArea.scrollTop = messagesArea.scrollHeight;
      }

      messageInput.addEventListener('input', function () {
        autoResize(this);
      });

      function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
      }

      window.addEventListener('DOMContentLoaded', function () {
        var savedSession = loadSession();
        if (savedSession) {
          username = savedSession.username;
          sessionId = savedSession.sessionId;
          isReconnecting = true;
          console.log('üîÑ Sesi√≥n detectada, preparando auto-conexi√≥n:', username);
        }
      });
    </script>
  </body>
</html>